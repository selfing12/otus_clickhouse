# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ClickHouse: –•—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ Kafka-—Å–æ–±—ã—Ç–∏–π

## –ö–æ–º–ø–∞–Ω–∏—è
–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π DevOps-–ø—Ä–æ–µ–∫—Ç (NDA).

## –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
–¶–µ–ª—å - –ø–æ—Å—Ç—Ä–æ–∏—Ç—å **–Ω–∞–¥—ë–∂–Ω—É—é –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é —Å–∏—Å—Ç–µ–º—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–±—ã—Ç–∏–π**, –ø–æ—Å—Ç—É–ø–∞—é—â–∏—Ö –∏–∑ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –≤ Kafka. 
–≠—Ç–∏ —Å–æ–±—ã—Ç–∏—è –º—ã —Å–æ–±–∏—Ä–∞–µ–º –¥–ª—è:
- –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤;
- SLA –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –¥–µ–π—Å—Ç–≤–∏—è–º.

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–µ–∫
- **ClickHouse** ( DEV –∫–ª–∞—Å—Ç–µ—Ä: 2 —à–∞—Ä–¥–∞, –ø–æ 2 —Ä–µ–ø–ª–∏–∫–∏)
- **Kafka** (–≤—Ö–æ–¥–Ω–æ–π –ø–æ—Ç–æ–∫ —Å–æ–±—ã—Ç–∏–π)
- **Materialized View** + `Kafka`- engine —Ç–∞–±–ª–∏—Ü—ã
- **ReplicatedMergeTree** —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
- **Grafana** –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- **Redpanda** –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã **Kafka**

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
1. –°–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏ –≤ Kafka.
2. –í ClickHouse —Å–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ —Å `ENGINE = Kafka`.
3. –ß–µ—Ä–µ–∑ `MATERIALIZED VIEW` —Å–æ–±—ã—Ç–∏—è –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É —Å `ENGINE = ReplicatedMergeTree`.
4. –î–∞–Ω–Ω—ã–µ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º: `toYYYYMMDD(event_time)`
5. –•—Ä–∞–Ω—è—Ç—Å—è –∞–≥—Ä–µ–≥–∞—Ç—ã, –º–µ—Ç–∫–∏, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Å–æ–±—ã—Ç–∏–π.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- **–¢–∞–±–ª–∏—Ü—ã**: –ª–æ–≥–∏—á–µ—Å–∫–∏ —Ä–∞–∑–±–∏—Ç—ã –ø–æ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è –∏ —Å–µ—Ä–≤–∏—Å—É
- **TTL**: –¥–ª—è –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ 1 –≥–æ–¥
- **–ò–Ω–¥–µ–∫—Å—ã**: `SAMPLE BY event_id` + `PRIMARY KEY (event_time, service_name)`
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ ingestion** - –Ω–µ –±–æ–ª–µ–µ 1‚Äì2 —Å–µ–∫—É–Ω–¥
- **–û–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö** - –æ–∫–æ–ª–æ 50 –º–ª–Ω —Å–æ–±—ã—Ç–∏–π –≤ —Å—É—Ç–∫–∏ (~10 –ì–ë –≤ —Å–∂–∞—Ç–æ–º –≤–∏–¥–µ)

### –ü–æ—á–µ–º—É –≤—ã–±—Ä–∞–ª–∏ ClickHouse
- –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∞–≥—Ä–µ–≥–∞—Ü–∏–π
- –ù–∏–∑–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ—Å—É—Ä—Å–∞–º —Ö—Ä–∞–Ω–µ–Ω–∏—è
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞

## –†–µ–∑—É–ª—å—Ç–∞—Ç

- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ ‚Äî **100-300 –º—Å**
- –£–ø—Ä–æ—â—ë–Ω –∞—É–¥–∏—Ç –ø–æ —Å–æ–±—ã—Ç–∏—è–º –≤ —Å–∏—Å—Ç–µ–º–µ
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥ —Ä–æ—Å—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —Ç—Ä–∞—Ñ–∏–∫–∞

## –í—ã–≤–æ–¥

ClickHouse –æ—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –∑–∞–¥–∞—á–µ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π –∏–∑ Kafka, –ø—Ä–∏ —ç—Ç–æ–º –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—É—é –∏ –±—ã—Å—Ç—Ä—É—é —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–∫–∞—Ö.

---
## –í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã:
### –ö –∫–∞–∫–∏–º –∫–ª–∞—Å—Å–∞–º —Å–∏—Å—Ç–µ–º –æ—Ç–Ω–æ—Å–∏—Ç—Å—è ClickHouse?
- ClickHouse ‚Äî —ç—Ç–æ –∫–æ–ª–æ–Ω–æ—á–Ω–∞—è –°–£–ë–î.

### –û—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –∫–ª–∞—Å—Å—É:
- OLAP (Online Analytical Processing)
- Big Data / Data Warehousing
- Event Processing (–≤ —Å–≤—è–∑–∫–µ —Å Kafka)

### –ö–∞–∫—É—é –ø—Ä–æ–±–ª–µ–º—É –±—ã —Ä–µ—à–∏–ª —á–µ—Ä–µ–∑ ClickHouse?
–ü–æ–ª—É—á–∏–ª–æ—Å—å –±—ã —Ä–µ—à–∏—Ç—å:
- –ü–æ—Ç–æ–∫–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ª–æ–≥–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫ (–≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ELK —Å—Ç–µ–∫–∞)
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—à–±–æ—Ä–¥–æ–≤ –ø–æ –±–∏–∑–Ω–µ—Å-—Å–æ–±—ã—Ç–∏—è–º
- –ê–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏ –æ—Ç—á—ë—Ç—ã –∏–∑ –º–∏–ª–ª–∏–æ–Ω–æ–≤ —Å—Ç—Ä–æ–∫

–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –±—ã —Ä–µ—à–∏—Ç—å:
- –•—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —á–∞—Å—Ç—ã–º–∏ –∞–ø–¥–µ–π—Ç–∞–º–∏ (–Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç —Ç–∞–∫ –∫–∞–∫ "–î–æ—Ä–æ–≥–æ", –∫–∞–∫ MySQL/Postgres)
- –†–∞–±–æ—Ç–∞—Ç—å —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ transactional DB


---
## –ò–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –º–æ–≥—É –ø—Ä–∏–≤–µ—Å—Ç–∏:
–°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã - https://clickhouse.com/docs/about-us/adopters

**–Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞**

–ö–æ–º–ø–∞–Ω–∏—è: **–Ø–Ω–¥–µ–∫—Å**

**–ü—Ä–æ–µ–∫—Ç:** –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –Ω–∞ —Å–∞–π—Ç–∞—Ö

**–ë–∏–∑–Ω–µ—Å-–ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–≥—Ä–æ–º–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —Å–æ–±—ã—Ç–∏–π ‚Äî –∫–ª–∏–∫–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä—ã, —Å–µ—Å—Å–∏–∏, —Ü–µ–ª–∏ –∏ —Ç.–¥. ‚Äî –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å –±—ã—Å—Ç—Ä—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** ClickHouse –±—ã–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –≤–Ω—É—Ç—Ä–∏ –Ø–Ω–¥–µ–∫—Å–∞ –∏–º–µ–Ω–Ω–æ –ø–æ–¥ –ú–µ—Ç—Ä–∏–∫—É.

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞—Ü–µ–Ω—Ç—Ä–∞–º, —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º.

- –•—Ä–∞–Ω–∏—Ç—Å—è —Å–æ—Ç–Ω–∏ –º–∏–ª–ª–∏–∞—Ä–¥–æ–≤ —Å—Ç—Ä–æ–∫, —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äî –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è MergeTree, –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, TTL –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

---
–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://clickhouse.com/docs/ru

GitHub Issues: https://github.com/ClickHouse/ClickHouse/issues

Telegram —á–∞—Ç: https://t.me/clickhouse_ru

Stack Overflow: https://stackoverflow.com/questions/tagged/clickhouse
